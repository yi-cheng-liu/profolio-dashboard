import{handleUseParams as W}from"@refinedev/core";import{useLocation as J,useParams as ee,Link as oe,useNavigate as te}from"react-router-dom";import w from"react";import{BrowserRouter as _,MemoryRouter as q,HashRouter as G}from"react-router-dom";import e,{useMemo as F}from"react";import{Route as a,Routes as k,Navigate as S,Outlet as N}from"react-router-dom";import{LoginPage as O,ErrorComponent as l,LayoutWrapper as z,useResource as B,useRefineContext as I,useRouterContext as U,CanAccess as v,useActiveAuthProvider as V,useIsAuthenticated as K}from"@refinedev/core";var x=({route:t})=>{let{catchAll:o}=I(),{useParams:n}=U(),{resources:f}=B(),{action:c,id:i}=n(),r=f.find(h=>h.route===t);if(r){let{list:h,create:y,edit:m,show:C,name:d,canCreate:P,canEdit:R,canShow:g,canDelete:E,options:s}=r,p=()=>console.error("`string` resource routes are not supported in legacy router. Please switch to the new router or assign Components to the resource routes."),u=()=>console.error("`Object` resource routes are not supported in legacy router. Please switch to the new router or assign Components to the resource routes."),b=(typeof h=="string"?p():typeof h=="object"?u():h)??(()=>null),M=(typeof y=="string"?p():typeof y=="object"?u():y)??(()=>null),X=(typeof m=="string"?p():typeof m=="object"?u():m)??(()=>null),D=(typeof C=="string"?p():typeof C=="object"?u():C)??(()=>null);return(()=>{switch(c){case void 0:return e.createElement(v,{resource:d,action:"list",fallback:o??e.createElement(l,null),params:{resource:r}},h?e.createElement(b,{name:d,canCreate:P,canEdit:R,canDelete:E,canShow:g,options:s}):o??e.createElement(l,null));case"create":case"clone":return e.createElement(v,{resource:d,action:"create",fallback:o??e.createElement(l,null),params:{id:i?decodeURIComponent(i):void 0,resource:r}},y?e.createElement(M,{name:d,canCreate:P,canEdit:R,canDelete:E,canShow:g,options:s}):o??e.createElement(l,null));case"edit":return e.createElement(v,{resource:d,action:"edit",params:{id:i?decodeURIComponent(i):void 0,resource:r},fallback:o??e.createElement(l,null)},m?e.createElement(X,{name:d,canCreate:P,canEdit:R,canDelete:E,canShow:g,options:s}):o??e.createElement(l,null));case"show":return e.createElement(v,{resource:d,action:"show",params:{id:i?decodeURIComponent(i):void 0,resource:r},fallback:o??e.createElement(l,null)},C?e.createElement(D,{name:d,canCreate:P,canEdit:R,canDelete:E,canShow:g,options:s}):o??e.createElement(l,null));default:return e.createElement(e.Fragment,null,o??e.createElement(l,null))}})()}return e.createElement(e.Fragment,null,o??e.createElement(l,null))},A=({initialRoute:t})=>{let{resources:o}=B(),{catchAll:n,DashboardPage:f,LoginPage:c}=I(),{routes:i}=U(),r=V(),{isFetching:h,isError:y,data:m}=K({v3LegacyAuthProviderCompatible:!!(r!=null&&r.isLegacy),params:{type:"routeProvider"}}),C=F(()=>r!=null&&r.isProvided?r!=null&&r.isLegacy?!(y||(m==null?void 0:m.error)):m==null?void 0:m.authenticated:!0,[m,y,r==null?void 0:r.isLegacy]);if(h)return e.createElement(k,null,e.createElement(a,{path:"*",element:null}));let d=()=>{let{pathname:s,search:p}=location,u=`${s}${p}`;return e.createElement(S,{to:`/login?to=${encodeURIComponent(u)}`})},P=[];o.map(s=>{let p=e.createElement(a,{key:`${s.route}`,path:`${s.route}`,element:e.createElement(x,{route:s.route})},e.createElement(a,{path:":action",element:e.createElement(x,{route:s.route})},e.createElement(a,{path:":id",element:e.createElement(x,{route:s.route})})));P.push(p)});let R=()=>{var s,p;return e.createElement(k,null,[...i||[]].filter(u=>!u.layout).map((u,b)=>e.createElement(a,{key:`custom-route-${b}`,...u,element:u.element})),e.createElement(a,{path:"/",element:e.createElement(z,null,e.createElement(N,null))},[...i||[]].filter(u=>u.layout).map((u,b)=>e.createElement(a,{key:`custom-route-${b}`,...u,element:u.element})),f?e.createElement(a,{index:!0,element:e.createElement(v,{resource:"dashboard",action:"list",fallback:n??e.createElement(l,null)},e.createElement(f,null))}):e.createElement(a,{index:!0,element:e.createElement(S,{to:t??`/${(p=(s=o.find(u=>u.list))==null?void 0:s.route)==null?void 0:p.replace(/^\//,"")}`})}),...[...P||[]],e.createElement(a,{path:"*",element:e.createElement(x,{route:""})})))},g=()=>c?e.createElement(c,null):e.createElement(O,null);return C?R():(()=>e.createElement(k,null,[...i||[]].map((s,p)=>e.createElement(a,{key:`custom-route-${p}`,...s})),e.createElement(a,{path:"/",element:g()}),e.createElement(a,{path:"/login",element:g()}),e.createElement(a,{path:"*",element:e.createElement(d,null)})))()};function $({children:t,...o}){return w.createElement(_,{...o},w.createElement(A,{initialRoute:typeof this<"u"?this.initialRoute:void 0}),t)}function Q({children:t,...o}){return w.createElement(q,{...o},w.createElement(A,{initialRoute:typeof this<"u"?this.initialRoute:void 0}),t)}function T({children:t,...o}){return w.createElement(G,{...o},w.createElement(A,{initialRoute:typeof this<"u"?this.initialRoute:void 0}),t)}import L from"react";import{UNSAFE_NavigationContext as Y}from"react-router-dom";function Z(t,o=!0){let{navigator:n}=L.useContext(Y);L.useEffect(()=>{if(!o)return;let f=n.go,c=n.push;return n.push=(...i)=>{t()!==!1&&c(...i)},n.go=(...i)=>{t()!==!1&&f(...i)},()=>{n.push=c,n.go=f}},[n,t,o])}function j(t,o=!0,n,f=!1){let c=L.useCallback(r=>(r.preventDefault(),r.returnValue=t,r.returnValue),[t]);L.useEffect(()=>(o&&!f&&window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}),[c,o,f]);let i=L.useCallback(()=>{let r=window.confirm(t);return r&&n&&n(),r},[t]);Z(i,o)}var H=({message:t,when:o,setWarnWhen:n})=>(j(t,o,()=>{n==null||n(!1)},!0),null);var re={useHistory:()=>{let t=te();return{push:t,replace:o=>{t(o,{replace:!0})},goBack:()=>{t(-1)}}},useLocation:J,useParams:()=>{let t=ee(),{pathname:o}=J(),n=`/${Object.values(t).join("/")}`;return W({...t,resource:Object.keys(t).length===0?o.substring(1):decodeURIComponent(o.substring(1)).replace(n,"")})},Prompt:H,Link:oe,RouterComponent:$},Ee=re;export{$ as BrowserRouterComponent,T as HashRouterComponent,Q as MemoryRouterComponent,Ee as default};
//# sourceMappingURL=legacy.mjs.map