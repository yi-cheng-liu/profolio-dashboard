#!/usr/bin/env node
var Re=Object.create;var D=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,we=Object.prototype.hasOwnProperty;var be=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ke(t))!we.call(e,i)&&i!==r&&D(e,i,{get:()=>t[i],enumerable:!(n=Ae(t,i))||n.enumerable});return e};var d=(e,t,r)=>(r=e!=null?Re(Te(e)):{},be(t||!e||!e.__esModule?D(r,"default",{value:e,enumerable:!0}):r,e));var Ee=d(require("express")),l=require("@refinedev/devtools-shared");var L=d(require("express")),b=d(require("path")),x=e=>{e.use(L.default.static(b.default.join(__dirname,"client"))),e.use((t,r,n)=>{if(t.path.startsWith("/api")||t.path.startsWith("/open-in-editor"))return n();r.status(200).sendFile(b.default.join(`${__dirname}/client/index.html`))})};var j=d(require("ws"));var y="https://cloud2.refine.dev",C="https://raw.githubusercontent.com/refinedev/refine/master/packages/devtools-server/FEED.md";var E=require("@refinedev/devtools-shared"),h=require("chalk"),N=(e,t)=>{let r=new j.default.Server({server:e}).on("error",n=>{(n==null?void 0:n.code)==="EADDRINUSE"?console.error(`
${h.cyanBright.bold("\u2717 ")}${(0,h.bold)("Refine Devtools server")} (websocket) failed to start. Port ${5001} is already in use.
`):console.error(`
${h.cyanBright.bold("\u2717 ")}${(0,h.bold)("error from refine devtools")}`,n),r.close(()=>{}),t()});return r.on("connection",n=>{(0,E.send)(n,E.DevtoolsEvent.DEVTOOLS_HANDSHAKE,{url:`http://localhost:${5001}`}),n.on("close",()=>{n.terminate()})}),process.on("SIGTERM",()=>{r.close(()=>{})}),r};var We=require("lodash"),Be=require("@refinedev/devtools-shared"),Ye=require("ws"),V=()=>0;var v=require("chalk"),U=d(require("http")),F=(e,t)=>{let r=U.default.createServer(e);return r.on("error",n=>{(n==null?void 0:n.code)==="EADDRINUSE"?console.error(`
${v.cyanBright.bold("\u2717 ")}${(0,v.bold)("Refine Devtools server")} (http) failed to start. Port ${5001} is already in use.
`):console.error(`
${v.cyanBright.bold("\u2717 ")}${(0,v.bold)("error from Refine Devtools")}`,n),r.close(()=>{}),t()}).on("listening",()=>{console.log(`
${v.cyanBright.bold("\u2713 ")}${(0,v.bold)("Refine Devtools")} is running at port ${v.cyanBright.bold(5001)}
`)}),process.on("SIGTERM",()=>{r.close(()=>{})}),r.listen(5001,void 0,void 0,()=>{}),r};var Ie={connectedApp:null,clientWs:null,devtoolsWsClients:[],appWsClients:[],activities:[],packages:[]},H=()=>({...Ie});var fe=require("express"),ue=d(require("lodash/uniq"));var $=d(require("node-fetch")),M=d(require("gray-matter")),_=require("marked"),R=d(require("sanitize-html"));var Se=e=>e.split("---section").slice(1).map(r=>`---section${r}`),Oe=e=>{let t=new _.marked.Renderer;t.link=function(...n){return _.marked.Renderer.prototype.link.apply(this,n).replace(/^<a/,'<a target="_blank" rel="noopener noreferrer"')};let r=(0,_.marked)(e,{renderer:t});return(0,R.default)(r,{allowedTags:R.default.defaults.allowedTags.concat(["img"]),allowedAttributes:{...R.default.defaults.allowedAttributes,img:["src"]}})},De=e=>{let t=(0,M.default)(e.replace("---section","---"));return{...t.data,content:Oe(t.content)}},Le=async()=>{try{return(await(0,$.default)(C)).text()}catch{return""}},J=async()=>{try{let e=await Le();return Se(e).map(De)}catch{return[]}};var B=d(require("fs"));var G=d(require("path")),W=d(require("globby")),q=async e=>{try{let t=await(0,W.default)(`node_modules/${e}/package.json`,{onlyFiles:!0}),r=null;try{let n=require.resolve(G.default.join(e,"package.json"));n&&(r=n)}catch{}return[...t,...r?[r]:[]][0]??null}catch{return null}};var K=async e=>{try{let t=await q(e);if(!t)return null;let r=JSON.parse(B.default.readFileSync(t,{encoding:"utf-8"}));return{name:r.name,version:r.version,description:r.description}}catch{return null}};var Q=d(require("path")),Y=require("fs-extra"),A=async(e=process.cwd())=>{let t=await(0,Y.readJSON)(Q.default.join(e,"package.json"),{encoding:"utf-8"});return Object.keys(t.dependencies).filter(n=>n.startsWith("@refinedev/"))};var z=e=>e.replace("@refinedev/","https://c.refine.dev/");var X=e=>"https://refine.dev/docs/api-reference/general-concepts/";var Z=async e=>{try{let t=await A(e);return await Promise.all(t.map(async n=>{let i=await K(n);return{name:n,currentVersion:i==null?void 0:i.version,description:i==null?void 0:i.description,changelog:z(n),documentation:X(n)}}))}catch{return[]}};var m=d(require("dedent"));var xe=[{name:"@refinedev/ably",description:"Ably integration for Refine",install:"npm install @refinedev/ably",usage:(0,m.default)(`
            import { liveProvider, Ably } from "@refinedev/ably";

            export const ablyClient = new Ably.Realtime("YOUR_API_TOKEN");

            const App = () => {
                return (
                    <Refine
                        liveProvider={liveProvider(ablyClient)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
        `.trim())},{name:"@refinedev/airtable",description:"Airtable integration for Refine",install:"npm install @refinedev/airtable",usage:(0,m.default)(`
            import dataProvider from "@refinedev/airtable";

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider("API_KEY", "BASE_ID")}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/antd",description:"Ant Design integration for Refine",install:"npm install @refinedev/antd antd",usage:(0,m.default)(`
            import { ThemedLayoutV2 } from "@refinedev/antd";

            import "@refinedev/antd/dist/reset.css";

            const App = () => {
                return (
                    <Refine
                        /* ... */
                    >
                        <ThemedLayoutV2>
                            {/* ... */}
                        </ThemedLayoutV2>
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/appwrite",description:"Appwrite integration for Refine",install:"npm install @refinedev/appwrite",usage:(0,m.default)(`
            import { dataProvider, liveProvider, Account, Appwrite, Storage } from "@refinedev/appwrite";

            const appwriteClient = new Appwrite();
            appwriteClient.setEndpoint("API_URL").setProject("PROJECT_ID");

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider(appwriteClient, { databaseId: "default" })}
                        liveProvider={liveProvider(appwriteClient, { databaseId: "default" })}
                        /* ... */
                    >
                        <ThemedLayout>
                            {/* ... */}
                        </ThemedLayout>
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/chakra-ui",description:"Chakra UI integration for Refine",install:"npm install @refinedev/chakra-ui @chakra-ui/react @emotion/react @emotion/styled framer-motion @tabler/icons-react",usage:(0,m.default)(`
            import { ThemedLayoutV2 } from "@refinedev/chakra-ui";
            import { ChakraProvider } from "@chakra-ui/react";

            const App = () => {
                return (
                        <ChakraProvider>
                        <Refine
                            /* ... */
                        >
                            <ThemedLayoutV2>
                                {/* ... */}
                            </ThemedLayoutV2>
                        </Refine>
                    </ChakraProvider>
                );
            };
            `.trim())},{name:"@refinedev/graphql",description:"GraphQL integration for Refine",install:"npm install @refinedev/graphql",usage:(0,m.default)(`
            import dataProvider, { GraphQLClient } from "@refinedev/graphql";

            const client = new GraphQLClient("YOUR_API_URL");

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider(client)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/hasura",description:"GraphQL integration for Refine",install:"npm install @refinedev/hasura",usage:(0,m.default)(`
            import dataProvider, { GraphQLClient } from "@refinedev/hasura";

            const client = new GraphQLClient("HASURA_API_URL", {
                headers: {
                    "x-hasura-role": "public",
                },
            });

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider(client)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/inferencer",description:"Auto generate views based on your APIs with Refine",install:"npm install @refinedev/inferencer",usage:(0,m.default)(`
        import { AntdInferencer } from "@refinedev/inferencer/antd";

        const App = () => {
            return (
                <Refine
                    /* ... */
                >
                    <AntdInferencer action="list" resource="posts" />
                </Refine>
            );
        };
        `.trim())},{name:"@refinedev/kbar",description:"Command palette integration with kbar for Refine",install:"npm install @refinedev/kbar",usage:(0,m.default)(`
            import { RefineKbar, RefineKbarProvider } from "@refinedev/kbar";

            const App = () => {
                return (
                    <RefineKbarProvider>
                        <Refine
                            /* ... */
                        >
                            <RefineKbar />
                        </Refine>
                    </RefineKbarProvider>
                );
            };
        `.trim())},{name:"@refinedev/mantine",description:"Mantine UI integration for Refine",install:"npm install @refinedev/mantine @refinedev/react-table @mantine/core @mantine/hooks @mantine/form @mantine/notifications @emotion/react @tabler/icons-react",usage:(0,m.default)(`
            import { ThemedLayoutV2 } from "@refinedev/mantine";
            import { MantineProvider } from "@mantine/core";

            const App = () => {
                return (
                    <MantineProvider>
                        <Refine
                            /* ... */
                        >
                            <ThemedLayoutV2>
                                {/* ... */}
                            </ThemedLayoutV2>
                        </Refine>
                    </MantineProvider>
                );
            };
            `.trim())},{name:"@refinedev/medusa",description:"Medusa store integration for Refine",install:"npm install @refinedev/medusa",usage:(0,m.default)(`
            import dataProvider, { authProvider } from "@refinedev/medusa";

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider("API_URL")}
                        authProvider={authProvider("API_URL")}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/mui",description:"Material UI integration for Refine",install:"npm install @refinedev/mui @refinedev/react-hook-form @mui/material @mui/lab @mui/x-data-grid @emotion/react @emotion/styled react-hook-form",usage:(0,m.default)(`
            import { ThemedLayoutV2 } from "@refinedev/mui";

            import CssBaseline from "@mui/material/CssBaseline";
            import GlobalStyles from "@mui/material/GlobalStyles";
            import { ThemeProvider } from "@mui/material/styles";

            const App = () => {
                return (
                    <ThemeProvider>
                        <CssBaseline />
                        <GlobalStyles styles={{ html: { WebkitFontSmoothing: "auto" } }} />
                        <Refine
                            /* ... */
                        >
                            <ThemedLayoutV2>
                                {/* ... */}
                            </ThemedLayoutV2>
                        </Refine>
                    </ThemeProvider>
                );
            };
            `.trim())},{name:"@refinedev/nestjs-query",description:"NestJS Query data provider integration for Refine",install:"npm install @refinedev/nestjs-query graphql-ws",usage:(0,m.default)(`
            import dataProvider, {
                GraphQLClient,
                liveProvider,
            } from "@refinedev/nestjs-query";

            import { createClient } from "graphql-ws";

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider(new GraphQLClient( "API_URL" ))}
                        liveProvider={liveProvider(createClient({ url: "WS_URL" }))}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/nestjsx-crud",description:"NestJSX CRUD data provider integration for Refine",install:"npm install @refinedev/nestjsx-crud",usage:(0,m.default)(`
            import dataProvider from "@refinedev/nestjsx-crud";

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider("API_URL")}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/react-hook-form",description:"React Hook Form integration for Refine",install:"npm install @refinedev/react-hook-form react-hook-form",usage:(0,m.default)(`
            import { useForm } from "@refinedev/react-hook-form";

            const EditPost = () => {
                const {
                    register,
                    handleSubmit,
                    formState,
                    refineCore,
                } = useForm({
                    refineCoreProps: {
                        resource: "posts",
                        id: "1",
                    },
                });

                return /* ... */
            };
            `.trim())},{name:"@refinedev/react-table",description:"Tanstack React Table integration for Refine",install:"npm install @refinedev/react-table @tanstack/react-table",usage:(0,m.default)(`
            import { useTable } from "@refinedev/react-table";

            import { ColumnDef, flexRender } from "@tanstack/react-table";

            const EditPost = () => {
                const columns = React.useMemo<ColumnDef<IPost>[]>(
                    () => [
                        {
                            id: "id",
                            header: "ID",
                            accessorKey: "id",
                        },
                        {
                            id: "title",
                            header: "Title",
                            accessorKey: "title",
                            meta: {
                                filterOperator: "contains",
                            },
                        },
                ], []);

                const tableInstance = useTable({
                    columns,
                    refineCoreProps: {
                        resource: "posts",
                    }
                });

                return /* ... */
            };
            `.trim())},{name:"@refinedev/simple-rest",description:"Data provider integration for REST APIs with Refine",install:"npm install @refinedev/simple-rest",usage:(0,m.default)(`
            import dataProvider from "@refinedev/simple-rest";

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider("API_URL")}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/supabase",description:"Data provider and live provider integrations for Supabase with Refine",install:"npm install @refinedev/supabase",usage:(0,m.default)(`
            import { dataProvider, liveProvider, createClient } from "@refinedev/supabase";

            const supabaseClient = createClient("SUPABASE_URL", "SUPABASE_KEY");

            const App = () => {
                return (
                    <Refine
                        dataProvider={dataProvider(supabaseClient)}
                        liveProvider={liveProvider(supabaseClient)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/strapi",description:"Strapi integration of Refine",install:"npm install @refinedev/strapi axios",usage:(0,m.default)(`
            import { DataProvider, AuthHelper } from "@refinedev/strapi";

            const axiosInstance = axios.create();
            const strapiAuthHelper = AuthHelper("API_URL");

            const App = () => {
                return (
                    <Refine
                        dataProvider={DataProvider("API_URL", axiosInstance)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())},{name:"@refinedev/strapi-v4",description:"StrapiV4 integration of Refine",install:"npm install @refinedev/strapi-v4 axios",usage:(0,m.default)(`
            import { DataProvider, AuthHelper } from "@refinedev/strapi-v4";

            const axiosInstance = axios.create();
            const strapiAuthHelper = AuthHelper("API_URL");

            const App = () => {
                return (
                    <Refine
                        dataProvider={DataProvider("API_URL", axiosInstance)}
                        /* ... */
                    >
                        {/* ... */}
                    </Refine>
                );
            };
            `.trim())}],ee=async e=>{let t=await A(e);return xe.filter(r=>!t.includes(r.name))};var te=d(require("preferred-pm")),re=d(require("execa")),ne=async(e,t=process.cwd())=>{try{let{name:r}=await(0,te.default)(t)??{name:"npm"},{failed:n}=await(0,re.default)(r??"npm",["install",...e.map(i=>`${i}@latest`)]);return!n}catch{return!1}};var oe=d(require("execa")),ie=async e=>{try{let{stdout:t}=await(0,oe.default)("npm",["view",e,"name","version","--json"]);return JSON.parse(t)}catch{return{name:e}}};var ae=require("fs-extra"),se=d(require("path")),k=async(e=process.cwd())=>{var t;try{let r=await(0,ae.readJSON)(se.default.join(e,"package.json"),{encoding:"utf-8"}),n=(t=r==null?void 0:r.refine)==null?void 0:t.projectId;return n||!1}catch{return null}};var ce=d(require("execa")),le=async(e,t=process.cwd())=>{try{return ce.default.sync("npm",["pkg","set",`refine.projectId=${e}`],{cwd:t}),!0}catch{return null}};var de=d(require("execa")),I=d(require("path")),pe=async(e,t=process.cwd())=>{try{let r=require.resolve(".bin/jscodeshift"),n=de.default.sync(r,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${I.default.resolve(I.default.join(__dirname,"..","src","project-id","transform.ts"))}`,"--ignore-pattern=**/.cache/**","--ignore-pattern=**/node_modules/**","--ignore-pattern=**/build/**","--ignore-pattern=**/dist/**","--ignore-pattern=**/.next/**",`--__projectId=${e}`],{cwd:t,timeout:1e3*10});n.stderr&&console.error(n.stderr)}catch(r){console.error(r)}};var me=async(e,t=process.cwd())=>{try{return await Promise.all([le(e,t),pe(e,t)]),!0}catch{return!1}};var ve=(e,t)=>{e.use("/api",(0,fe.json)()),e.get("/api/connected-app",(a,o)=>{o.json({url:t.connectedApp})}),e.get("/api/activities",(a,o)=>{let{offset:s=0,limit:p=t.activities.length}=a.query;o.setHeader("x-total-count",t.activities.length),o.json({data:t.activities.slice(Number(s),Number(p))})}),e.get("/api/activities/reset",(a,o)=>{t.activities=[],o.json({success:!0})}),e.get("/api/unique-trace-items",(a,o)=>{o.header("Access-Control-Allow-Origin","*"),o.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept");let s=t.activities.flatMap(f=>{var u;return((u=f.trace)==null?void 0:u.map(P=>P.function).filter(Boolean))??[]}),p=(0,ue.default)(s);o.setHeader("x-total-count",p.length),o.json({data:p})});let r=null;e.get("/api/installed-packages",async(a,o)=>{let{force:s}=a.query??{};(!r||s)&&(r=await Z()),o.header("x-total-count",`${r.length}`),o.json({data:r})});let n=null;e.get("/api/available-packages",async(a,o)=>{n||(n=await ee()),o.header("x-total-count",`${n.length}`),o.json({data:n})});let i=new Map;e.get("/api/packages/:packageName/latest",async(a,o)=>{let{packageName:s}=a.params??{};if(!s){o.status(400).json({error:"Package name is required"});return}if(!i.has(s)){let p=await ie(s);i.set(s,p)}return o.json({data:i.get(s)})}),e.post("/api/packages/install",async(a,o)=>{let{packages:s}=a.body??{};if((s==null?void 0:s.length)===0){o.status(400).json({error:"Package name is required"});return}await ne(s)?(r=null,n=null,o.status(200).json({success:!0})):o.status(400).json({success:!1,error:"Failed to update package"})});let c=null;e.get("/api/feed",async(a,o)=>{c||(c=await J()),o.header("x-total-count",`${c.length}`),o.json({data:c})}),e.get("/api/project-id/status",async(a,o)=>{let s=await k();if(s){o.status(200).json({projectId:s});return}if(s===!1){o.status(404).json({projectId:null});return}o.status(500).json({projectId:null})}),e.post("/api/project-id/update",async(a,o)=>{let{projectId:s}=a.body??{};if(!s){o.status(400).json({error:"Project ID is required"});return}if(await me(s)){o.status(200).json({success:!0});return}o.status(500).json({success:!1,error:"Failed to update project ID"})})};var w=require("fs-extra"),ge=require("@ory/client"),S=require("http-proxy-middleware"),O=d(require("path"));var T=null,Ce=async(e,t,r)=>{T||(T=await k()),T&&(e.headers["x-project-id"]=T),r()},je=(e,t)=>{if(t.body){let r=JSON.stringify(t.body);e.setHeader("Content-Type","application/json"),e.setHeader("Content-Length",Buffer.byteLength(r)),e.write(r)}},Ne=async e=>{try{let t=`${y}/.auth`,r=new ge.FrontendApi({isJsonMime:()=>!0,basePath:t,baseOptions:{withCredentials:!0}}),{data:n}=await r.toSession({xSessionToken:e,tokenizeAs:"jwt_template_1"});return n==null?void 0:n.tokenized}catch{}},Ve=async(e,t)=>{try{(0,w.writeJSON)(O.default.join(__dirname,"..",".persist.json"),{token:e,jwt:t})}catch{}},Ue=async()=>{try{return await(0,w.readJSON)(O.default.join(__dirname,"..",".persist.json"))}catch{}return{token:void 0,jwt:void 0}},Fe=e=>(t,r)=>{if(r.url.includes("self-service/logout/api")){let n=JSON.stringify({session_token:e});t.setHeader("Content-Length",Buffer.byteLength(n)),t.write(n)}},He=e=>(t,r,n)=>{let i="";t.on("data",c=>{i+=c}),t.on("end",()=>{var a;let c;try{c=JSON.parse(i).session_token}catch{}if(!c){if((a=i==null?void 0:i.includes)!=null&&a.call(i,"an+account+with+the+same+identifier")){n.redirect("/after-login?error=An+account+with+the+same+identifier+exists+already");return}n.redirect("/after-login?error=Invalid-session-token");return}Ne(c).then(o=>{e(c,o??""),n.redirect("/after-login")})})},he=async e=>{let{token:t,jwt:r}=await Ue(),n=(0,S.createProxyMiddleware)({target:y,changeOrigin:!0,pathRewrite:{"^/api/.auth":"/.auth"},cookieDomainRewrite:{"refine.dev":"localhost"},logLevel:"silent",headers:{"auth-base-url-rewrite":`http://localhost:${5001}/api/.auth`},selfHandleResponse:!0,onProxyReq:(c,a,...o)=>{t&&(c.setHeader("X-Session-Token",t??""),Fe(t)(c,a,...o))},onProxyRes:(c,a,o)=>{var p;let s=(p=c.headers["set-cookie"])==null?void 0:p.map(f=>f.replace("Domain=refine.dev;","Domain=localhost;").replace(" HttpOnly; Secure; SameSite=Lax",""));if(s&&(c.headers["set-cookie"]=s),a.url.includes("self-service/methods/oidc/callback"))return He((f,u)=>{t=f,r=u,Ve(t,r)})(c,a,o);c.statusCode===401?o.writeHead(200,{...c.headers,"Access-Control-Expose-Headers":`Refine-Is-Authenticated, ${c.headers["Access-Control-Expose-Headers"]}`}):o.writeHead(c.statusCode||500,c.headers),c.pipe(o,{end:!0})}});e.use("/api/.auth",n);let i=(0,S.createProxyMiddleware)({target:y,secure:!1,changeOrigin:!0,logLevel:"silent",pathRewrite:{"^/api/.refine":"/.refine"},onProxyReq:(c,...a)=>{r&&(c.setHeader("Authorization",`Bearer ${r}`),c.removeHeader("cookie")),je(c,...a)}});e.use("/api/.refine",Ce,i)};var Pe=d(require("path")),ye=(e,t)=>{e.get("/open-in-editor/*",(r,n)=>{let{line:i,column:c}=r.query,a=r.path.replace("/open-in-editor",""),o=`vscode://file/${Pe.default.join(t,a)}?${i?`line=${i}`:""}${c?`&column=${c}`:""}`;n.redirect(o)})};var _e=async({projectPath:e=process.cwd(),onError:t=()=>{process.exit(1)}}={})=>new Promise((r,n)=>{let i=(0,Ee.default)(),c=F(i,()=>{n(),t()}),a=N(c,()=>{n(),t()}),o=H();a.on("connection",s=>{(0,l.receive)(s,l.DevtoolsEvent.DEVTOOLS_INIT,p=>{o.connectedApp?(0,l.send)(s,l.DevtoolsEvent.DEVTOOLS_ALREADY_CONNECTED,{url:o.connectedApp}):(o.connectedApp=p.url,o.clientWs=s,a.clients.forEach(f=>{(0,l.send)(f,l.DevtoolsEvent.DEVTOOLS_CONNECTED_APP,{url:o.connectedApp})}))}),(0,l.receive)(s,l.DevtoolsEvent.ACTIVITY,p=>{let f=o.activities.findIndex(P=>P.identifier===p.identifier),u={...p,createdAt:Date.now(),updatedAt:Date.now()};f>-1?(u.createdAt=o.activities[f].createdAt,o.activities[f]=u):o.activities.push(u),a.clients.forEach(P=>{(0,l.send)(P,l.DevtoolsEvent.DEVTOOLS_ACTIVITY_UPDATE,{updatedActivities:[u]})})}),(0,l.receive)(s,l.DevtoolsEvent.DEVTOOLS_HIGHLIGHT_IN_MONITOR,({name:p})=>{a.clients.forEach(f=>{(0,l.send)(f,l.DevtoolsEvent.DEVTOOLS_HIGHLIGHT_IN_MONITOR_ACTION,{name:p})})}),(0,l.receive)(s,l.DevtoolsEvent.DEVTOOLS_INVALIDATE_QUERY,({queryKey:p})=>{a.clients.forEach(f=>{(0,l.send)(f,l.DevtoolsEvent.DEVTOOLS_INVALIDATE_QUERY_ACTION,{queryKey:p})})}),(0,l.receive)(s,l.DevtoolsEvent.DEVTOOLS_LOGIN_SUCCESS,()=>{a.clients.forEach(p=>{(0,l.send)(p,l.DevtoolsEvent.DEVTOOLS_RELOAD_AFTER_LOGIN,{})})}),s.on("close",(p,f)=>{o.clientWs&&(a.clients.has(o.clientWs)||(o.clientWs=null,o.connectedApp=null,o.activities=[],a.clients.forEach(u=>{(0,l.send)(u,l.DevtoolsEvent.DEVTOOLS_DISCONNECTED_APP,{url:o.connectedApp})})))})}),V(a),x(i),ve(i,o),he(i),ye(i,e),process.on("SIGTERM",()=>{n()})});_e().catch(()=>0);
//# sourceMappingURL=cli.cjs.map