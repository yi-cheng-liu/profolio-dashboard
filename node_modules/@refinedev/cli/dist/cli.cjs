#!/usr/bin/env node
var io=Object.create;var Te=Object.defineProperty;var so=Object.getOwnPropertyDescriptor;var ao=Object.getOwnPropertyNames;var co=Object.getPrototypeOf,lo=Object.prototype.hasOwnProperty;var mo=(e,t)=>{for(var r in t)Te(e,r,{get:t[r],enumerable:!0})},po=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ao(t))!lo.call(e,n)&&n!==r&&Te(e,n,{get:()=>t[n],enumerable:!(o=so(t,n))||o.enumerable});return e};var s=(e,t,r)=>(r=e!=null?io(co(e)):{},po(t||!e||!e.__esModule?Te(r,"default",{value:e,enumerable:!0}):r,e));var to=require("commander"),ro=s(require("figlet"));var Ae=s(require("chalk")),de=s(require("center-align"));var rt=s(require("ora")),uo=async(e,t)=>{let r=(0,rt.default)({color:"cyan",text:t}).start(),o=await e();return r.stop(),o},_=uo;var ae=s(require("execa")),S=require("fs-extra"),ot=s(require("globby")),Se=s(require("path")),nt=s(require("preferred-pm")),F=()=>{if(!(0,S.existsSync)("package.json"))throw new Error("./package.json not found");return JSON.parse((0,S.readFileSync)("package.json","utf8"))},$=()=>{let e=F();return Object.keys(e.dependencies||{})};var it=()=>{let e=F();return Object.keys(e.devDependencies||{})},fo=()=>[...$(),...$()],ce=()=>F().scripts,z=async()=>{var e;try{let t=await(0,ae.default)("npm",["ls","--depth=0","--json"],{reject:!1}),r=((e=JSON.parse(t.stdout))==null?void 0:e.dependencies)||{},o=Object.keys(r).filter(i=>i.startsWith("@refinedev")||i.startsWith("@pankod/refine-")),n=[];for(let i of o){let c=r[i].version;n.push({name:i,version:c})}return n}catch{return Promise.resolve(null)}},Z=async()=>{let e=["ably","airtable","antd","appwrite","chakra-ui","codemod","core","devtools","devtools-internal","devtools-server","devtools-shared","devtools-ui","graphql","hasura","inferencer","kbar","mantine","medusa","mui","nestjs-query","nestjsx-crud","nextjs-router","react-hook-form","react-router-v6","react-table","remix-router","shared","simple-rest","strapi","strapi-v4","supabase"];try{let t=await(0,ot.default)("node_modules/@refinedev/*",{onlyDirectories:!0}),r=e.flatMap(n=>{try{let i=require.resolve(Se.default.join("@refinedev",n,"package.json"));return[Se.default.dirname(i)]}catch{return[]}}),o=[];return await Promise.all([...r,...t].map(async n=>{if(await(0,S.pathExists)(`${n}/package.json`)){let c=await(0,S.readJSON)(`${n}/package.json`);o.push({name:c.name,version:c.version,path:n})}})),o}catch{return[]}},st=async e=>await(0,S.pathExists)(`${e}/refine.config.js`),U={npm:{install:["install","--save"],installDev:["install","--save-dev"],outdatedJson:["outdated","--json"]},yarn:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--json"]},pnpm:{install:["add"],installDev:["add","-D"],outdatedJson:["outdated","--format","json"]},bun:{install:["add"],installDev:["add","--dev"],outdatedJson:["outdated","--format","json"]}},b=async()=>{let e=await _(()=>(0,nt.default)(process.cwd()),"Getting package manager...");if(!e)throw new Error("Package manager not found.");return e},le=async e=>{let t=await b();try{let r=U[t.name].install,o=(0,ae.default)(t.name,[...r,...e],{stdio:"inherit"});o.on("message",n=>{console.log(n)}),o.on("error",n=>{console.log(n)}),o.on("exit",n=>{if(n===0){console.log("All `Refine` packages updated  \u{1F389}");return}console.log(`Application exited with code ${n}`)})}catch(r){throw new Error(r)}},De=async e=>{let t=await b();try{let r=U[t.name].install,o=ae.default.sync(t.name,[...r,...e],{stdio:"inherit"});if(o.failed||o.exitCode!==0)throw new Error(o.stderr);return o}catch(r){throw new Error(r)}},at=e=>{let t=e.lastIndexOf("@");return t<=0?{name:e,version:null}:{name:e.slice(0,t),version:e.slice(t+1)}},ct=()=>{var t;let e=F();return(t=e==null?void 0:e.refine)==null?void 0:t.projectId},me=async()=>(await Z()).some(t=>t.name==="@refinedev/devtools"),go=e=>{let t=$();return e.filter(r=>!t.includes(r))},lt=async e=>{console.log("\u{1F331} Checking dependencies...");let t=go(e);t.length>0?(console.log(`\u{1F331} Installing ${t.join(", ")}`),await De(t),console.log("\u{1F389} Installation complete...")):console.log("\u{1F389} All required packages are already installed")},mt=e=>{let t=fo(),r=e.filter(o=>t.includes(o));return r.length>0?(console.log(`\u{1F6A8} This feature doesn't support ${r.join(", ")} package.`),!0):!1};var ft=s(require("cli-table3")),ee=s(require("chalk"));var pt=e=>e.charAt(0).toUpperCase()+e.slice(1),dt=e=>e.replace(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"");var Q={name:"name",current:"current",wanted:"wanted",latest:"latest",changelog:"changelog"},Oe=[Q.name,Q.current,Q.wanted,Q.latest,Q.changelog],pe=(e=[])=>{var E;let t=Object.keys((e==null?void 0:e[0])||{});if(!e||!t.length)return{table:"",width:0};let r=process.stdout.columns||80,o=Math.max(...e.map(m=>m.name.length))+2,n=7+2,i=6,c=Math.min(35,r-o-n*3-i),a={name:o,current:n,wanted:n,latest:n,changelog:c},g=new ft.default({head:Oe,wordWrap:!1,wrapOnWordBoundary:!0,colWidths:Oe.map(m=>a[m]),style:{head:["blue"]}}),p=(m,l)=>{if(m.length>l){let d=l-3,u=m.slice(0,Math.floor(d/2)),v=m.slice(-Math.ceil(d/2));return`${u}...${v}`}return m};e.forEach(m=>{g.push(Oe.map(l=>{let d=m[l];if(!d)return d;if(l==="latest"||l==="wanted"){let u=ut(m.current),v=ut(d),y=ho(u,v),j=ee.default[y.major](v.major),C=ee.default[y.minor](v.minor),G=ee.default[y.patch](v.patch);return`${j}.${C}.${G}`}return l==="changelog"?ee.default.blueBright.underline(d):d}))});let f=g.toString(),P=dt(((E=f.split(`
`))==null?void 0:E[0])||"").length;return{table:f,width:P}},ut=e=>{let t=e.split(".");return{major:t[0],minor:t[1],patch:t[2]}},ho=(e,t)=>e.major.trim()!==t.major.trim()?{major:"red",minor:"red",patch:"red"}:e.minor.trim()!==t.minor.trim()?{major:"white",minor:"yellow",patch:"yellow"}:e.patch.trim()!==t.patch.trim()?{major:"white",minor:"white",patch:"green"}:{major:"white",minor:"white",patch:"white"};var ue=async e=>{let t=e==null?void 0:e.data,r=Object.keys((t==null?void 0:t[0])||{});if(!t||!r.length)return;let{table:o,width:n}=pe(t);console.log(),console.log((0,de.default)("Update Available",n)),console.log(o),console.log((0,de.default)(`To update ${Ae.default.bold("`Refine`")} packages with wanted version`,n)),console.log((0,de.default)(` Run the following command: ${Ae.default.yellowBright(await vo())}`,n)),console.log()},vo=async()=>{let e="npx @refinedev/cli update",t=$(),r=Object.keys(ce()),o=t.includes("@refinedev/cli"),n=r.includes("refine");if(!o&&!n)return e;let i=await b();return n?`${i.name} run refine update`:o?"npx refine update":e};var gt=s(require("execa"));var ht=s(require("semver-diff")),yo=e=>e.command("check-updates").description("Check all installed `Refine` packages are up to date").action(wo),wo=async()=>{let e=await _(te,"Checking for updates...");if(!e.length){console.log("All `Refine` packages are up to date \u{1F389}\n");return}await ue({data:e})},te=async()=>await Po(),Po=async()=>{let e=await xo();if(!e)return[];let t=[],r;return Object.keys(e).forEach(n=>{let i=e[n];n.includes("@refinedev")&&(r=n.replace(/@refinedev\//,"https://c.refine.dev/"),t.push({name:n,current:i.current,wanted:i.wanted,latest:i.latest,changelog:r}))}),t.filter(n=>!!(0,ht.default)(n.current,n.latest))},xo=async()=>{let e="npm",{stdout:t,timedOut:r}=await(0,gt.default)(e,U[e].outdatedJson,{reject:!1,timeout:25e3});if(r)throw new Error("Timed out while checking for updates.");return t?JSON.parse(t):null},vt=yo;var w=(a=>(a.REACT_SCRIPT="react-scripts",a.REMIX="remix",a.NEXTJS="nextjs",a.VITE="vite",a.CRACO="craco",a.PARCEL="parcel",a.UNKNOWN="unknown",a))(w||{});var je=(n=>(n.ANTD="antd",n.MUI="mui",n.MANTINE="mantine",n.CHAKRA="chakra-ui",n))(je||{});var yt=(o=>(o.NPM="npm",o.YARN="yarn",o.PNPM="pnpm",o))(yt||{});var h=e=>{if(e)return e;let t=$(),r=it();return t.includes("@craco/craco")||r.includes("@craco/craco")?"craco":t.includes("react-scripts")||r.includes("react-scripts")?"react-scripts":t.includes("next")||r.includes("next")?"nextjs":t.includes("@remix-run/react")||r.includes("@remix-run/react")?"remix":t.includes("vite")||r.includes("vite")?"vite":t.includes("parcel")||r.includes("parcel")?"parcel":"unknown"},wt=()=>{let e=$();if(e.includes("@refinedev/antd"))return"antd";if(e.includes("@refinedev/mui"))return"mui";if(e.includes("@refinedev/chakra-ui"))return"chakra-ui";if(e.includes("@refinedev/mantine"))return"mantine"};var re=e=>{switch(e){case"nextjs":return{path:"src/components",alias:"../src/components"};case"remix":return{path:"app/components",alias:"~/components"}}return{path:"src/pages",alias:"pages"}},Pt=e=>{switch(e){case"nextjs":return{path:"src/providers",alias:"../src/providers"};case"remix":return{path:"app/providers",alias:"~/providers"}}return{path:"src/providers",alias:"providers"}},xt=e=>{switch(e){case"remix":return"./app";default:return"./src"}};var B=s(require("handlebars")),T=require("fs-extra"),Io=(e,t)=>{let r=(0,T.readFileSync)(e);return B.default.registerHelper("ifIn",(n,i,c)=>n.includes(i)?c.fn(B.default):c.inverse(B.default)),B.default.registerHelper("formatInferencerComponent",n=>{if(n)switch(n){case"chakra-ui":return"ChakraUI";default:return n.charAt(0).toUpperCase()+n.slice(1)}}),B.default.registerHelper("capitalize",n=>{if(n)return n.charAt(0).toUpperCase()+n.slice(1)}),B.default.compile(r.toString())(t)},It=(e,t)=>{(0,T.readdirSync)(e).forEach(o=>{let n=`${e}/${o}`,i=`${e}/${o.replace(".hbs","")}`;(0,T.createFileSync)(i),(0,T.writeFileSync)(i,Io(n,t)),(0,T.unlinkSync)(n)})};var Rt=s(require("execa")),k=require("fs-extra"),Et=s(require("inquirer")),_e=require("path"),Ct=require("pluralize"),ge=s(require("temp")),fe=["list","create","edit","show"],V=async(e,t)=>{var n;let r=(e==null?void 0:e.path)||re(h()).path,o=e.actions||fe.join(",");if(!t.length){let{name:i,selectedActions:c}=await Et.default.prompt([{type:"input",name:"name",message:"Resource Name (users, products, orders etc.)",validate:a=>a?!0:"Resource Name is required"},{type:"checkbox",name:"selectedActions",message:"Select Actions",choices:fe,default:(n=e==null?void 0:e.actions)==null?void 0:n.split(",")}]);t=[i],o=c.join(",")}t.forEach(i=>{let c=o?o.split(","):void 0,a=(0,Ct.plural)(i).toLowerCase(),g=(0,_e.join)(process.cwd(),r,a);if((0,k.pathExistsSync)(g)){console.error(`\u274C Resource (${(0,_e.join)(r,a)}) already exist!`);return}let p=pt(i),f=wt(),P=`${__dirname}/../templates/resource`,E=Ro();(0,k.copySync)(P,E);let m={resourceName:i,resource:p,actions:c||fe,uiFramework:f};It(E,m),c&&fe.forEach(y=>{c.includes(y)||(0,k.unlinkSync)(`${E}/${y}.tsx`)}),(0,k.mkdirSync)(r,{recursive:!0});let l=`${r}/${a}`,d={};(0,k.pathExistsSync)(l)&&(d={overwrite:!0}),(0,k.moveSync)(E,l,d),ge.default.cleanupSync();let u=require.resolve(".bin/jscodeshift"),{stderr:v}=Rt.default.sync(u,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/resource.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist",`--__actions=${m.actions}`,`--__pathAlias=${re(h()).alias}`,`--__resourceFolderName=${a}`,`--__resource=${p}`,`--__resourceName=${i}`]);v&&console.log(v),console.log(`\u{1F389} Resource (${l}) generated successfully!`)})},Ro=()=>(ge.default.track(),ge.default.mkdirSync("resource"));var Eo=e=>{let t=h(),{path:r}=re(t);return e.command("create-resource").allowExcessArguments(!0).description('Create a new resource files (deprecated, please use "add resource" command)').option("-a, --actions [actions]","Only generate the specified actions. (ex: list,create,edit,show)","list,create,edit,show").option("-p, --path [path]","Path to generate the resource files",r).action(Co)},Co=async(e,t)=>{V(e,t.args)},bt=Eo;var kt=s(require("dotenv"));kt.config();var bo={development:/dev/i,production:/prod/i,test:/test|tst/i,"continuous-integration":/ci/i,"user-acceptance-testing":/uat/i,"system-integration-testing":/sit/i},ko=()=>{let e=process.env.NODE_ENV;if(!e)return"development";let t="custom";for(let[r,o]of Object.entries(bo))if(o.test(e)){t=r;break}return t},N={NODE_ENV:ko(),REFINE_NO_TELEMETRY:process.env.REFINE_NO_TELEMETRY||"false",UPDATE_NOTIFIER_IS_DISABLED:process.env.UPDATE_NOTIFIER_IS_DISABLED||"false",UPDATE_NOTIFIER_CACHE_TTL:process.env.UPDATE_NOTIFIER_CACHE_TTL||1e3*60*60*24,REFINE_PROXY_DOMAIN:process.env.REFINE_PROXY_DOMAIN||"https://refine.dev",REFINE_PROXY_TARGET:process.env.REFINE_PROXY_TARGET||"http://localhost:3000",REFINE_PROXY_PORT:process.env.REFINE_PROXY_PORT||"7313",REFINE_PROXY_REWRITE_URL:process.env.REFINE_REWRITE_URL||"http://localhost:7313"};var Nt=s(require("express")),he=require("http-proxy-middleware"),No=e=>e.command("proxy").description("Manage proxy settings").action(To).option("-p, --port [port]","Port to serve the proxy server. You can also set this with the `REFINE_PROXY_PORT` environment variable.",N.REFINE_PROXY_PORT).option("-t, --target [target]","Target to proxy. You can also set this with the `REFINE_PROXY_TARGET` environment variable.",N.REFINE_PROXY_TARGET).option("-d, --domain [domain]","Domain to proxy. You can also set this with the `REFINE_PROXY_DOMAIN` environment variable.",N.REFINE_PROXY_DOMAIN).option("-r, --rewrite-url [rewrite URL]","Rewrite URL for redirects. You can also set this with the `REFINE_PROXY_REWRITE_URL` environment variable.",N.REFINE_PROXY_REWRITE_URL),To=async({port:e,target:t,domain:r,rewriteUrl:o})=>{let n=(0,Nt.default)(),c=new URL(t).protocol==="http:"?a=>{var g;a.headers["set-cookie"]&&((g=a.headers["set-cookie"])==null||g.forEach((p,f)=>{var P;(P=a==null?void 0:a.headers)!=null&&P["set-cookie"]&&(a.headers["set-cookie"][f]=p.replace("Secure;",""))}))}:void 0;n.use("/.refine",(0,he.createProxyMiddleware)({target:`${r}/.refine`,changeOrigin:!0,pathRewrite:{"^/.refine":""},logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy rewrite rule created")||(`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.refine to ${r}/.refine`):a&&console.log(a))},warn:console.warn,debug:console.debug,error:console.error})})),n.use("/.auth",(0,he.createProxyMiddleware)({target:`${r}/.auth`,changeOrigin:!0,cookieDomainRewrite:{"refine.dev":""},headers:{"auth-base-url-rewrite":`${o}/.auth`},pathRewrite:{"^/.auth":""},logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy rewrite rule created")||(`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e}/.auth to ${r}/.auth`):a&&console.log(a))},warn:console.warn,debug:console.debug,error:console.error}),onProxyRes:c})),n.use("*",(0,he.createProxyMiddleware)({target:`${t}`,changeOrigin:!0,ws:!0,logProvider:()=>({log:console.log,info:a=>{`${a}`.includes("Proxy created")?console.log(`Proxying localhost:${e} to ${t}`):a&&console.log(a)},warn:console.warn,debug:console.debug,error:console.error})})),n.listen(Number(e))},Tt=No;var $t=require("commander");var Ot=s(require("conf")),At=s(require("chalk"));var St=e=>typeof btoa<"u"?btoa(e):Buffer.from(e).toString("base64");var So="refine-update-notifier",D=new Ot.default({projectName:So,defaults:{key:"",lastUpdated:0,packages:[]}}),W=async()=>{if(_o())return;let e=await Oo();if(e!==null){if(e){Dt();return}Do(),Dt()}},Do=async()=>{let e=D.get("packages");e!=null&&e.length&&(await ue({data:e}),console.log(`
`))},Oo=async()=>{let e=await jo(),t=Ao();return e===null?null:!!(t||!e)},Dt=async()=>{try{let e=await te();return D.set("packages",e),D.set("lastUpdated",Date.now()),D.set("key",await jt()),e}catch{return D.set("packages",[]),D.set("lastUpdated",Date.now()),D.set("key",""),null}},Ao=()=>{let e=D.get("lastUpdated");if(!e)return!0;let r=Date.now()-e,o=Number(N.UPDATE_NOTIFIER_CACHE_TTL);return r>=o},jo=async()=>{let e=D.get("key"),t=await jt();return t===null?null:e===t},jt=async()=>{let e=await z();if(!e)return console.error(At.default.red("Something went wrong when trying to get installed `Refine` packages.")),null;let t=e.map(o=>`${o.name}@${o.version}`);return St(t.toString())},_o=()=>N.UPDATE_NOTIFIER_IS_DISABLED.toLocaleLowerCase()==="true";var I={["react-scripts"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>require.resolve(".bin/react-scripts")},["vite"]:{getDev:e=>["dev",...e],getStart:e=>["preview",...e],getBuild:e=>["build",...e],getBin:()=>require.resolve(".bin/vite")},["nextjs"]:{getDev:e=>["dev",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>require.resolve(".bin/next")},["remix"]:{getDev:e=>["dev",...e],getStart:e=>(e==null?void 0:e.length)?e:(console.log(),console.warn("\u{1F6A8} Remix requires a path to the entry file. Please provide it as an argument to `refine start` command in package.json scripts"),console.warn("Refine will use `./build/index.js` as default"),console.warn("Example: `refine start ./build/index.js`"),console.log(),["./build/index.js"]),getBuild:e=>["build",...e],getBin:e=>{let t=e==="start"?"remix-serve":"remix";return require.resolve(`.bin/${t}`)}},["craco"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>require.resolve(".bin/craco")},["parcel"]:{getDev:e=>["start",...e],getStart:e=>["start",...e],getBuild:e=>["build",...e],getBin:()=>require.resolve(".bin/parcel")},["unknown"]:{getDev:e=>[...e],getStart:e=>[...e],getBuild:e=>[...e],getBin:()=>"unknown"}};var _t=s(require("execa")),O=async(e,t)=>{var o,n;if(e==="unknown"){let i=Object.values(w).filter(c=>c!=="unknown").join(", ");console.error(`We couldn't find executable for your project. Supported executables are ${i}.
Please use your own script directly. If you think this is an issue, please report it at: https://github.com/refinedev/refine/issues`);return}let r=(0,_t.default)(e,t,{stdio:"pipe",windowsHide:!1,env:{FORCE_COLOR:"true",...process.env}});return(o=r.stdout)==null||o.pipe(process.stdout),(n=r.stderr)==null||n.pipe(process.stderr),await r};var q=e=>{let t=h(),r=[];switch(e){case"dev":r=I[t].getDev([""]);break;case"start":r=I[t].getStart([""]);break;case"build":r=I[t].getBuild([""]);break}return t==="remix"&&e==="start"&&(t="remix-serve"),`It runs: \`${t} ${r.join(" ")}\`. Also accepts all the arguments \`${t}\` accepts.`},Y=()=>`Platform to run command on. 
ex: ${Object.values(w).join(", ")}`;var $o=e=>e.command("start").description(q("start")).allowUnknownOption(!0).addOption(new $t.Option("-p, --platform <platform>",Y()).choices(Object.values(w).filter(t=>t!=="unknown"))).argument("[args...]").action(Fo),Fo=async(e,{platform:t})=>{let r=h(t),o=I[r].getBin("start"),n=I[r].getStart(e);await W(),O(o,n)},$e=$o;var Le=require("commander");var Mt=require("@refinedev/devtools-server");var Ft=s(require("execa"));var ve=require("prettier"),Fe=async e=>{try{let t=await(0,ve.resolveConfig)(process.cwd());return(0,ve.format)(e,{...t??{},parser:"typescript"})}catch{return e}};var Ut=async()=>{let e=require.resolve(".bin/jscodeshift"),{stderr:t}=Ft.default.sync(e,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/add-devtools-component.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);t&&console.log(t)};var Bt=()=>{let t=F().scripts||{};return{dev:((t==null?void 0:t.dev)||"").match(/refine dev(\s|$|;){1}/)!==null}};var Lt=s(require("boxen")),zt=s(require("cardinal")),Be=s(require("chalk")),Vt=require("commander"),Wt=s(require("dedent")),ye=s(require("semver")),Uo=["start","init"],Bo="start",qt="4.42.0",Mo=e=>e.command("devtools").description("Start or install Refine Devtools server; it starts on port 5001.").addArgument(new Vt.Argument("[command]","devtools related commands").choices(Uo).default(Bo)).addHelpText("after",`
Commands:
    start     Start Refine Devtools server
    init      Install Refine Devtools client and adds it to your project
`).action(Lo),Lo=async e=>{switch(e){case"start":Me();return;case"init":zo();return}},zo=async()=>{var n;let e=await Ue();if(await _(me,"Checking if devtools is installed...")){console.log("\u{1F389} Refine Devtools is already installed");return}if(e&&await Yt({pkg:e}))return;console.log("\u{1F331} Installing Refine Devtools...");let r=["@refinedev/devtools@latest"];if((!e||ye.default.lt(e.version,qt))&&(r.push("@refinedev/core@latest"),console.log("\u{1F331} Refine core package is being updated for devtools...")),await De(r),console.log(""),console.log(""),console.log("\u{1F331} Adding devtools component to your project...."),await Ut(),console.log("\u2705 Refine Devtools package and components added to your project"),r.includes("@refinedev/core@latest")){let i=await Ue();console.log(`\u2705 Refine core package updated from ${(e==null?void 0:e.version)??"unknown"} to ${(i==null?void 0:i.version)??"unknown"}`),console.log(`   Changelog: ${Be.default.underline.blueBright(`https://c.refine.dev/core#${(e==null?void 0:e.version.replaceAll(".",""))??""}`)}`)}console.log("");let{dev:o}=Bt();if(o){console.log(`\u{1F64C} You're good to go. "npm run dev" will automatically starts the devtools server.`),console.log('\u{1F449} You can also start the devtools server manually by running "refine devtools start"');return}if(!o){let i=(n=F().scripts)==null?void 0:n.dev;console.log('\u{1F6A8} Your have modified the "dev" script in your package.json. Because of that, "npm run dev" will not start the devtools server automatically.'),console.log('\u{1F449} You can append "refine devtools" to "dev" script'),console.log('\u{1F449} You can start the devtools server manually by running "refine devtools"'),console.log(""),console.log((0,Lt.default)(zt.default.highlight((0,Wt.default)(`
                {
                    "scripts": {
                        "dev": "${i} & refine devtools",
                        "refine": "refine"
                    }
                }  
        `)),{padding:1,title:"package.json",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"}))}},Me=async({exitOnError:e=!0}={})=>{let t=await Ue();if(t){if(await Yt({pkg:t}))return;if(ye.default.lt(t.version,qt)){console.log(`\u{1F6A8} You're using an old version of Refine(${t.version}). Refine version should be @4.42.0 or higher to use devtools.`);let r=await b();console.log(`\u{1F449} You can update @refinedev/core package by running "${r.name} run refine update"`);return}}(0,Mt.server)({onError:()=>{e&&process.exit(1)}}).catch(r=>{})},Ue=async()=>{let e=await Z(),t=e==null?void 0:e.find(r=>r.name==="@refinedev/core"||r.name==="@pankod/refine-core");if(t)return t},Yt=async({pkg:e})=>e.name==="@pankod/refine-core"||ye.default.lt(e.version,"4.0.0")?(console.log(`\u{1F6A8} You're using an old version of Refine(${e.version}). Refine version should be @4.42.0 or higher to use devtools.`),console.log("You can follow migration guide to update Refine."),console.log(Be.default.blue("https://refine.dev/docs/migration-guide/3x-to-4x/")),!0):!1,Xt=Mo;var Vo=e=>e.command("dev").description(q("dev")).allowUnknownOption(!0).addOption(new Le.Option("-p, --platform <platform>",Y()).choices(Object.values(w).filter(t=>t!=="unknown"))).addOption(new Le.Option("-d, --devtools <devtools>","Start Refine Devtools server").default("true","true if devtools is installed")).argument("[args...]").action(Wo),Wo=async(e,{platform:t,...r})=>{let o=h(t),n=I[o].getBin("dev"),i=I[o].getDev(e);await W();let c=await me();(r.devtools==="false"?!1:c)&&Me({exitOnError:!1}),O(n,i)},ze=Vo;var Jt=require("commander");var qo=e=>e.command("build").description(q("build")).allowUnknownOption(!0).addOption(new Jt.Option("-p, --platform <platform>",Y()).choices(Object.values(w).filter(t=>t!=="unknown"))).argument("[args...]").action(Yo),Yo=async(e,{platform:t})=>{let r=h(t),o=I[r].getBin("build"),n=I[r].getBuild(e);await W();try{await O(o,n)}catch{process.exit(1)}},Ve=qo;var We=s(require("chalk"));var Xo=e=>e.command("run").description("Runs a defined package script. If no `command` is provided, it will list the available scripts").allowUnknownOption(!0).argument("[command] [args...]").action(Jo),Jo=async e=>{let[t,...r]=e,o=ce();if(!t){console.log(`Available via ${We.default.blue("`refine run`")}:
`);for(let[c,a]of Object.entries(o))console.log(`  ${c}`),console.log(`    ${We.default.dim(a)}`),console.log();return}if(!Object.keys(o).includes(t)){let c=`${process.cwd()}/node_modules/.bin/${t}`;O(c,r);return}let i=await b();O(i.name,["run",t,...r])},qe=Xo;var He=s(require("path")),M=s(require("chalk")),oe=s(require("inquirer")),yr=s(require("inquirer-autocomplete-prompt")),A=require("fs-extra");var Xe=s(require("path"));var tr=s(require("path"));var Ye={};mo(Ye,{PackageManagerTypes:()=>yt,ProjectTypes:()=>w,UIFrameworks:()=>je,appendAfterImports:()=>Zt,getFileContent:()=>we,getImports:()=>X,getNameChangeInImport:()=>Kt});var Ho=/import(?:(?:(?:[ \n\t]+([^ *\n\t\{\},]+)[ \n\t]*(?:,|[ \n\t]+))?([ \n\t]*\{(?:[ \n\t]*[^ \n\t"'\{\}]+[ \n\t]*,?)+\})?[ \n\t]*)|[ \n\t]*\*[ \n\t]*as[ \n\t]+([^ \n\t\{\}]+)[ \n\t]+)from[ \n\t]*(?:['"])([^'"\n]+)(?:['"])(?:;?)/g,Ko=/((?:\w|\s|_)*)( as )((?:\w|\s|_)*)( |,)?/g,X=e=>{let t=e.matchAll(Ho),r=[];for(let o of t){let[n,i,c,a,g]=o;r.push({statement:n,importPath:g,...i&&{defaultImport:i},...c&&{namedImports:c},...a&&{namespaceImport:a}})}return r==null?void 0:r.filter(Boolean)},Kt=e=>{let t=e.matchAll(Ko),r=[];for(let o of t){let[n,i,c,a,g]=o;r.push({statement:n,fromName:i.trim(),toName:a.trim(),afterCharacter:g})}return r},Go=(e,t)=>{var i;let r=e.substring(0,e.indexOf(t.statement)),o=X(r).pop();return o?r.substring(r.indexOf(o==null?void 0:o.statement)+((i=o==null?void 0:o.statement)==null?void 0:i.length)):r},Zo=(e,t)=>!!(t?Go(e,t):"").trim(),Ht=["react","@refinedev/core","@refinedev/"],Gt=e=>{var m;let t=e,r=X(e),o=r.filter(l=>!l.statement.includes("import type ")),n=r.filter(l=>l.statement.includes("import type")),i=[],c=[];o.forEach(l=>{Zo(e,l)?i.push(l):c.push(l)});let a=t.indexOf((m=c==null?void 0:c[0])==null?void 0:m.statement);c.forEach(l=>{t=t.replace(l.statement,"")}),n.forEach(l=>{t=t.replace(l.statement,"")});let g=c.reduce((l,d)=>{let{importPath:u}=d;return l[u]?l[u].push(d):l[u]=[d],l},{}),P=[...Object.entries(g).map(([l,d])=>{let u=d.find(C=>C.defaultImport),v=d.find(C=>C.namespaceImport),y=d.filter(C=>C.namedImports).map(C=>(C.namedImports??"").replace(/{|}/g,"").trim().split(",").map(Ne=>Ne.trim()).filter(Boolean).join(", ")).join(", "),j="";return v&&(j+=`${v.statement}
`),(u||y)&&(u&&y?j+=`import ${u.defaultImport}, { ${y} } from "${d[0].importPath}";
`:u?j+=`import ${u.defaultImport} from "${d[0].importPath}";
`:j+=`import { ${y} } from "${d[0].importPath}";
`),[l,j]})].sort(([l],[d])=>{let u=Ht.findIndex(y=>l.includes(y)),v=Ht.findIndex(y=>d.includes(y));return u===v?l.localeCompare(d):u===-1?1:v===-1?-1:u-v}).map(([,l])=>l).join(""),E=n.map(l=>l.statement).join(`
`);return t=t.substring(0,a)+P+E+t.substring(a),t};var Zt=(e,t)=>{let r=X(e),o=r[r.length-1],n=o?e.indexOf(o.statement):e.length-1;return`${e.slice(0,n+(o==null?void 0:o.statement.length))}
${t}
${e.slice(n+(o==null?void 0:o.statement.length))}`};var Qt=require("fs-extra"),er=require("path");function we(e){if(this!=null&&this.absolutePackageDir)try{return(0,Qt.readFileSync)((0,er.join)(this.absolutePackageDir,e)).toString()}catch{return}}var rr=require("module"),Qo=rr.prototype.require,or=(e,t)=>{rr.prototype.require=function(...r){return r[0]==="@refinedev/cli"?{...Ye,getFileContent:o=>we.call({absolutePackageDir:t?e:tr.default.join(process.cwd(),e)},o)}:Qo.apply(this,r)}};var Je=async(e,t)=>{try{return or(e,t),require(Xe.default.join(t?e:Xe.default.join(process.cwd(),e),"refine.config.js"))}catch{return}};var mr=s(require("dedent"));var R={SUCCESS:"SUCCESS",UNKNOWN_ERROR:"UNKNOWN_ERROR",SOURCE_PATH_NOT_FOUND:"SOURCE_PATH_NOT_FOUND",TARGET_PATH_NOT_FOUND:"TARGET_PATH_NOT_FOUND",SOURCE_PATH_NOT_A_FILE:"SOURCE_PATH_NOT_A_FILE",TARGET_ALREADY_EXISTS:"TARGET_ALREADY_EXISTS"};var x=s(require("chalk"));var nr=s(require("chalk")),ir=s(require("cardinal")),sr=s(require("boxen")),en=e=>{let t=/^(?:\/\/\s?title:\s?)(.*?)\n/g,[r,o]=t.exec(e)??[];if(o){let n=o.trim(),i=e.replace(r||"","");return{title:n,code:i}}return{code:e}},ar=e=>{let{title:t,code:r}=en(e),o="";try{o=ir.default.highlight(r,{jsx:!0})}catch{o=r}return(0,sr.default)(o,{padding:1,margin:0,borderStyle:"round",borderColor:"gray",titleAlignment:"left",title:t?nr.default.bold(t):void 0})};var cr=require("marked"),lr=s(require("marked-terminal")),Pe=e=>(0,cr.marked)(e,{renderer:new lr.default({code:ar})});var pr=({label:e,files:t,message:r="**`Warning:`** You should use the component where you want to use it."})=>{let o=t.filter(([,p])=>Object.values(R).filter(f=>f!==R.SUCCESS).includes(p)),n="success";switch(o.length){case 0:n="success";break;case t.length:n="error";break;default:n="warning";break}let i=p=>{let f=p==null?void 0:p.replace(process.cwd(),"");return f!=null&&f.startsWith("/")?f.slice(1):f!=null&&f.startsWith("./")?f.slice(2):f},c=()=>{switch(n){case"success":console.log(x.default.blueBright(`Successfully swizzled ${x.default.bold(e)}`));return;case"warning":console.log(x.default.yellowBright(`Swizzle completed with errors for ${x.default.bold(e)}`));return;case"error":console.log(x.default.redBright(`Swizzle failed for ${x.default.bold(e)}`));return;default:return}},a=()=>{let p=[];p.push(x.default.dim(`File${t.length>1?"s":""} created:`)),p.push(t.map(([f,P])=>P===R.SUCCESS?x.default.cyanBright.dim(` - ${i(f)}`):P===R.TARGET_ALREADY_EXISTS?x.default.cyanBright.dim(` - ${x.default.yellowBright.bold("[FILE_ALREADY_EXISTS] ")}${i(f)}`):P===R.SOURCE_PATH_NOT_A_FILE?x.default.cyanBright.dim(` - ${x.default.yellowBright.bold("[SOURCE NOT FOUND] ")}${i(f)}`):x.default.cyanBright.dim(` - ${x.default.yellowBright.bold(`[${P}]`)}${i(f)}`)).join(`
`)),console.log(p.join(`
`))},g=()=>{r&&n!=="error"&&console.log(Pe((0,mr.default)(`
${r}`)))};console.log(""),c(),a(),console.log(""),g()};var dr=e=>{let t=/(\/\/|\/\*)(\s?)swizzle-remove-start([\s\S]*?)(\/\/|\/\*)(\s?)swizzle-remove-end(\s*)(\*\/)?/g;return e.replace(t,"")};var wr=s(require("boxen"));var ur=()=>{let e;try{e=h()}catch{e=void 0}return xt(e)};var fr=s(require("inquirer")),gr=s(require("chalk"));var hr=async e=>{await tn(e)?await le(e):await rn(e)},tn=async e=>{let t=`This component requires following packages to be installed:
`.concat(e.map(o=>` - ${o}`).join(`
`)).concat(`
Do you want to install them?`),{installRequiredPackages:r}=await fr.default.prompt([{type:"confirm",name:"installRequiredPackages",default:!0,message:t}]);return r},rn=async e=>{let t=await b(),r=U[t.name].install.join(" "),o=e.join(" "),n=`${t.name} ${r} ${o}`;console.log(`
You can install them manually by running this command:`),console.log(gr.default.bold.blueBright(n))};var on=e=>e.command("swizzle").description(`Export a component or a function from ${M.default.bold("Refine")} packages to customize it in your project`).action(nn),vr=e=>(t,r="")=>e.filter(n=>{var i;return n.label.toLowerCase().includes(r.toLowerCase())||((i=n.group)==null?void 0:i.toLowerCase().includes(r.toLowerCase()))}).flatMap((n,i,c)=>{var p;return[...(n==null?void 0:n.group)&&((p=c[i-1])==null?void 0:p.group)!==n.group&&n.group?[new oe.default.Separator(M.default.bold(n.group))]:[],{name:` ${n.label}`,value:n!=null&&n.value?n.value:n}]}),nn=async e=>{var f,P,E;oe.default.registerPrompt("autocomplete",yr.default);let t=await Z(),r=[];if(await Promise.all(t.map(async m=>{let l=await st(m.path),d=r.findIndex(u=>u.name===m.name)===-1;l&&d&&r.push(m)})),r.length===0){console.log("No Refine packages found with swizzle configuration.");return}console.log(`${(0,wr.default)(`Found ${M.default.blueBright(r.length)} installed ${M.default.blueBright.bold("Refine")} packages with swizzle configuration.`,{padding:1,textAlignment:"center",dimBorder:!0,borderColor:"blueBright",borderStyle:"round"})}
`);let o=await Promise.all(r.map(async m=>{let l=await Je(m.path,!0)??await Je(m.path,!1)??{swizzle:{items:[]}};return{...m,config:l}})),{selectedPackage:n}=await oe.default.prompt([{type:"autocomplete",pageSize:10,name:"selectedPackage",message:"Which package do you want to swizzle?",emptyText:"No packages found.",source:vr(o.sort((m,l)=>{var d,u;return(((d=m.config)==null?void 0:d.group)??"").localeCompare(((u=l.config)==null?void 0:u.group)??"")}).map(m=>{var l,d;return{label:((l=m.config)==null?void 0:l.name)??m.name,value:m,group:(d=m.config)==null?void 0:d.group}}))}]),{swizzle:{items:i,transform:c}}=n.config,a;if(i.length===0){console.log(`No swizzle items found for ${M.default.bold(((f=n.config)==null?void 0:f.name)??n.name)}`);return}if(i.length===1?a=i[0]:i.length>1&&(a=(await oe.default.prompt([{type:"list",pageSize:10,name:"selectedComponent",message:"Which component do you want to swizzle?",emptyText:"No components found.",choices:vr(i.sort((l,d)=>l.group.localeCompare(d.group)))({},"")}])).selectedComponent),!a){console.log(`No swizzle items selected for ${M.default.bold(((P=n.config)==null?void 0:P.name)??n.name)}`);return}let g=ur(),p=await Promise.all(a.files.map(async m=>{var l;try{let d=m.src?He.default.join(n.path,m.src):void 0,u=m.dest?He.default.join(process.cwd(),g,m.dest):void 0;if(!d)return console.log("No src path found for file",m),["",R.SOURCE_PATH_NOT_FOUND];if(!u)return console.log("No destination path found for file",m),["",R.TARGET_PATH_NOT_FOUND];if(!await(0,A.pathExists)(d))return[u,R.SOURCE_PATH_NOT_A_FILE];let y=await(0,A.readFile)(d,"utf-8");if(await(0,A.pathExists)(u))return[u,R.TARGET_ALREADY_EXISTS];await(0,A.ensureFile)(u);let C=dr(y),G=((l=m.transform)==null?void 0:l.call(m,C))??C,Ne=(c==null?void 0:c(G,d,u))??G,oo=Gt(Ne),no=await Fe(oo);return await(0,A.writeFile)(u,no),[u,R.SUCCESS]}catch{return["",R.UNKNOWN_ERROR]}}));p.length>0&&(pr({files:p,label:a.label,message:a.message}),(E=a==null?void 0:a.requiredPackages)!=null&&E.length&&await hr(a.requiredPackages))},Pr=on;var Er=s(require("inquirer")),Cr=s(require("center-align")),br=require("commander");var J=s(require("inquirer")),Ke=s(require("semver-diff")),xe=s(require("chalk"));var xr=e=>{let t=e.filter((o,n)=>e.indexOf(o)!==n),r=new Set(t);return Array.from(r)};var Ir=async e=>{let t=an(e);if(!t){console.log("All `Refine` packages are up to date. \u{1F389}");return}let r=cn(t),o=await J.default.prompt([{type:"checkbox",name:"packages",message:"Choose packages to update",pageSize:r.pageSize,choices:r.choices,validate:sn}]);return o.packages.length>0?o.packages:null},sn=e=>{let r=e.map(n=>at(n)).map(n=>n.name),o=xr(r);return o.length>0?`You can't update the same package more than once. Please choice one.
 Duplicates: ${o.join(", ")}`:!0},an=e=>{if(e.length===0)return null;let t={patch:[],minor:[],major:[]};return e.forEach(r=>{let o=r.current,n=(0,Ke.default)(o,r.wanted),i=(0,Ke.default)(o,r.latest);if(n===i&&i){t[i].push({name:r.name,from:o,to:r.latest});return}n&&t[n].push({name:r.name,from:o,to:r.wanted}),i&&t[i].push({name:r.name,from:o,to:r.latest})}),t},cn=e=>{let t=0,r=0;[e.patch,e.minor,e.major].forEach(p=>{p.forEach(f=>{f.name.length>t&&(t=f.name.length),f.from.length>r&&(r=f.from.length)})}),t+=2;let o=[],n="Package".padEnd(t),i="From".padEnd(r),a=`
   ${n} ${i}${"To".padStart(r)}`;o.push(new J.default.Separator(a)),e.patch.length>0&&(o.push(new J.default.Separator(xe.default.reset.bold.blue(`
Patch Updates`))),e.patch.forEach(p=>{o.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})})),e.minor.length>0&&(o.push(new J.default.Separator(xe.default.reset.bold.blue(`
Minor Updates`))),e.minor.forEach(p=>{o.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})})),e.major.length>0&&(o.push(new J.default.Separator(xe.default.reset.bold.blue(`
Major Updates`))),e.major.forEach(p=>{o.push({name:`${p.name.padEnd(t)} ${p.from.padStart(r)} -> ${p.to}`,value:`${p.name}@${p.to}`})}));let g=o.length+6;return{choices:o,pageSize:g}};var ln=e=>e.command("update").description("Interactively select and update all `Refine` packages to selected version. To skip the interactive mode, use the `--all` option.").addOption(new br.Option("-t, --tag [tag]","Select version to update to.").choices(["next","latest"]).default("wanted","Version ranges in the `package.json` will be installed")).option("-a, --all","Update all `Refine` packages to the selected `tag`. If `tag` is not provided, version ranges in the `package.json` will be installed. This option skips the interactive mode.",!1).option("-d, --dry-run","Get outdated packages installation command without automatic updating. If `tag` is not provided, version ranges in the `package.json` will be used.",!1).action(mn),mn=async e=>{let{tag:t,dryRun:r,all:o}=e,n=await _(te,"Checking for updates...");if(!(n!=null&&n.length)){console.log("All `Refine` packages are up to date \u{1F389}");return}let i=null;if(o)Rr(t,n);else{let{table:c,width:a}=pe(n)??"";console.log((0,Cr.default)("Available Updates",a)),console.log(c);let{allByPrompt:g}=await Er.default.prompt([{type:"list",name:"allByPrompt",message:"Do you want to update all Refine packages for minor and patch versions?",choices:[{name:"Yes (Recommended)",value:!0},{name:"No, use interactive mode",value:!1}]}]);g?i=Rr(t,n):i=await Ir(n)}if(i){if(r){pn(i);return}dn(i)}},Rr=(e,t)=>e==="wanted"&&t.every(n=>n.current===n.wanted)?(console.log("All `Refine` packages are up to date with the wanted version \u{1F389}"),null):t.map(o=>{let n=e==="wanted"?o.wanted:e;return`${o.name}@${n}`}),pn=async e=>{let t=await b(),r=U[t.name].install;console.log(`${t.name} ${r.join(" ")} ${e.join(" ")}`)},dn=e=>{console.log("Updating `Refine` packages..."),console.log(e.map(t=>` - ${t}`).join(`
`)),le(e)},kr=ln;var Nr=s(require("envinfo")),Tr=s(require("ora")),un=e=>e.command("whoami").description("View the details of the development environment").action(fn),fn=async()=>{let e=(0,Tr.default)("Loading environment details...").start(),t=await Nr.default.run({System:["OS","CPU"],Binaries:["Node","Yarn","npm"],Browsers:["Chrome","Firefox","Safari"]},{showNotFound:!0,markdown:!0}),o=(await z()||[]).map(n=>` - ${n.name}: ${n.version}`).join(`
`);e.stop(),console.log(t),console.log("## Refine Packages:"),console.log(o)},Sr=un;var ie=s(require("chalk")),se=s(require("inquirer"));var $r=s(require("inquirer"));var Dr=s(require("execa")),Ie=async e=>{let{incompatiblePackages:t,integrationName:r,requiredPackages:o,transformerFileName:n}=e;if(mt(t))return;await lt(o),console.log(`\u{1F680} Setting up ${r}...`);let i=require.resolve(".bin/jscodeshift"),{stderr:c}=Dr.default.sync(i,["./","--extensions=ts,tsx,js,jsx","--parser=tsx",`--transform=${__dirname}/../src/transformers/integrations/${n}.ts`,"--ignore-pattern=.cache","--ignore-pattern=node_modules","--ignore-pattern=build","--ignore-pattern=.next","--ignore-pattern=dist"]);c&&console.log(c),console.log(`\u{1F389} ${r} setup completed!`)};var Re=s(require("chalk")),Ee=e=>{let{id:t,title:r,description:o,disabled:n}=e;return n?{value:t,name:`${Re.default.gray(r)}`,disabled:Re.default.redBright(n)}:{value:t,name:`${Re.default.blueBright(r)} - ${o}`}};var Or="ant-design",gn="Ant Design",hn=["@remix-run/react","next"],vn=["antd","@refinedev/antd"],yn="ant-design",Ar={id:Or,getChoice:e=>{let t="Ant Design",r="Setup Ant Design with Refine",o;return["nextjs","remix"].includes(e)&&(o="Automatic setup only available Vite for now. See the documentation for manual installation: https://refine.dev/docs/ui-integrations/ant-design/introduction/#installation"),Ee({id:Or,title:t,description:r,disabled:o})},runTransformer:async()=>await Ie({incompatiblePackages:hn,integrationName:gn,requiredPackages:vn,transformerFileName:yn})};var jr="react-router",wn="React Router",Pn=["@remix-run/react","next"],xn=["react-router-dom","@refinedev/react-router-v6"],In="react-router",_r={id:jr,getChoice:e=>{let t="React Router",r="Setup routing with React Router",o;return e==="nextjs"&&(o="Can't be used with Next.js. https://nextjs.org/docs/app/building-your-application/routing"),e==="remix"&&(o="Can't be used with Remix. https://remix.run/docs/en/main/discussion/routes"),Ee({id:jr,title:t,description:r,disabled:o})},runTransformer:async()=>await Ie({incompatiblePackages:Pn,integrationName:wn,requiredPackages:xn,transformerFileName:In})};var L=[Ar,_r];var Ge=()=>{let e=h(),t=L.map(r=>r.getChoice(e));return t.every(r=>r.disabled)?[{value:"none",name:"No integration available for this project type."},...t]:t},Fr=async()=>await $r.default.prompt([{type:"list",name:"id",message:"Which integration do you want to add?",choices:Ge(),default:"none"}]);var Ur=s(require("chalk")),Br=s(require("inquirer"));var K=require("fs-extra"),Ze=require("path");var H=[{id:"auth",title:"Auth provider",description:"Manage user authentication and authorization",fileName:"auth-provider.tsx",templateFileName:"demo-auth-provider.tsx.template"},{id:"live",title:"Live provider",description:"Enable real-time updates and synchronization",fileName:"live-provider.tsx",templateFileName:"demo-live-provider.tsx.template"},{id:"data",title:"Data provider",description:"Communicate with your API",fileName:"data-provider.tsx",templateFileName:"demo-data-provider.tsx.template"},{id:"access-control",title:"Access Control",description:"Manage user permissions & roles",fileName:"access-control-provider.tsx",templateFileName:"demo-access-control-provider.tsx.template"},{id:"notification",title:"Notification provider",description:"Display in-app alerts and messages",fileName:"notification-provider.tsx",templateFileName:"demo-notification-provider.tsx.template"},{id:"i18n",title:"I18n provider",description:"Support multiple languages and locales",fileName:"i18n-provider.tsx",templateFileName:"demo-i18n-provider.tsx.template"},{id:"audit-log",title:"Audit Log provider",description:"Display audit logs for your resources",fileName:"audit-log-provider.tsx",templateFileName:"demo-audit-log-provider.tsx.template"}];var Rn=`${__dirname}/../templates/provider`,ne=(e,t)=>{e.forEach(r=>{let{fileName:o,templateFileName:n}=En(r),i=t??Qe(),c=(0,Ze.join)(i,o),a=(0,Ze.join)(process.cwd(),i,o);if((0,K.pathExistsSync)(a)){console.error(`\u274C Provider (${c}) already exist!`);return}(0,K.mkdirSync)(i,{recursive:!0}),(0,K.copySync)(`${Rn}/${n}`,a),console.log(`\u{1F389} Provider (${c}) created successfully!`)})},En=e=>{let t=H.find(r=>r.id===e);if(!t)throw new Error(`Invalid provider: ${e}`);return t},Qe=()=>{let e=h(),{path:t}=Pt(e);return t};var et=()=>H.map(e=>{let{id:t,title:r,description:o}=e;return{value:t,name:`${Ur.default.blueBright(r)} - ${o}`}}),Mr=async()=>await Br.default.prompt([{type:"checkbox",name:"providers",message:"Which providers do you want to add?",choices:et()},{type:"input",name:"providersPath",message:"Where do you want to generate the providers?",default:Qe()}]);var Lr=(e,t)=>t.map(r=>({...r,name:` . ${r.name}`,value:{group:e,component:r.value}})),zr=async()=>await se.default.prompt([{type:"list",name:"component",message:"What do you want to add?",choices:[new se.default.Separator(ie.default.bold("Provider")),...Lr("provider",et()),new se.default.Separator(ie.default.bold("Integration")),...Lr("integration",Ge()),new se.default.Separator(ie.default.bold("Resource")),{name:ie.default.blueBright(" .  Add new resource"),value:{group:"resource",component:"resource"}}],pageSize:25}]);var Ce=require("commander");var Cn=async e=>{let t=e;t||(t=(await Fr()).id);let r=L.find(o=>o.id===t);r&&await r.runTransformer()},Vr=new Ce.Command("integration").addArgument(new Ce.Argument("[name]","Name of the integration").choices(L.map(e=>e.id))).action(Cn);var be=require("commander");var bn=async(e,t)=>{if(!e.length){let{providers:r,providersPath:o}=await Mr();return ne(r,o)}ne(e,t.path)},Wr=new be.Command("provider").addArgument(new be.Argument("[providers...]","Create provider(s)").choices(H.map(e=>e.id)).default([])).option("-p, --path [path]","Path to generate providers").action(bn);var ke=require("commander");var kn=async(e,t,r)=>{V({actions:t==null?void 0:t.actions,path:r.optsWithGlobals().path},e)},qr=new ke.Command("resource").addArgument(new ke.Argument("[resources...]","Create new resource(s)")).option("-p, --path [path]","Path to generated resource files").option("-a, --actions [actions]","Only generate the specified resource actions. (ex: list,create,edit,show)","list,create,edit,show").action(kn);var Nn=e=>e.command("add").description("Add new resources, providers, or integrations").allowExcessArguments(!1).action(Tn).addCommand(qr).addCommand(Wr).addCommand(Vr),Tn=async()=>{let{component:e}=await zr();if(e.group==="provider"&&ne([e.component]),e.group==="integration"){let t=L.find(r=>r.id===e.component);await(t==null?void 0:t.runTransformer())}e.group==="resource"&&await V({},[])},Yr=Nn;var Xr=s(require("envinfo")),Jr=s(require("os")),Sn=()=>{let e=Jr.default.type();return{Darwin:"macOS",Linux:"Linux",Windows_NT:"Windows"}[e]},Hr=async()=>{let[e,t]=await Xr.default.helpers.getOSInfo();return{name:Sn(),version:t}};var Kr=s(require("node-fetch")),Dn=async()=>{let e=await Hr();return{nodeEnv:N.NODE_ENV,nodeVersion:process.version,os:e.name,osVersion:e.version,command:process.argv[2],packages:await z()||[],projectFramework:h(),projectId:ct()}},Gr=async()=>{if(N.REFINE_NO_TELEMETRY!=="true")try{let e=await Dn();await(0,Kr.default)("https://telemetry.refine.dev/cli",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}catch{}};var Zr=s(require("gray-matter")),Qr=s(require("boxen"));var On="https://raw.githubusercontent.com/refinedev/refine/master/packages/cli/ANNOUNCEMENTS.md",tt="---announcement",An=e=>e.split(tt).slice(1).map(r=>`${tt}${r}`),jn=e=>{let t=e.replace(tt,"---"),r=(0,Zr.default)(t),o=(r.content.length===0?t.replace(/---/g,""):r.content.replace(/---/g,"")).trim();return{...r.data,content:o}},_n=async()=>{try{let e=await fetch(On).then(r=>r.text()).catch(()=>"");return An(e).map(r=>jn(r))}catch{return[]}},eo=async()=>{let t=(await _n()).filter(o=>!o.hidden);if(t.length===0)return;let r=t.map(o=>{let n=t.length>1?"\u2014 ":"",i=Pe(o.content);return`${n}${i}`}).join("").trim();console.log((0,Qr.default)(r,{padding:1,margin:0,borderStyle:"round",borderColor:"blueBright",titleAlignment:"left"}))};var $n="1.0.0",Fn=()=>{let e=new to.Command;e.version(`@refinedev/cli@${$n}`,"-v, --version","Output the current version.").description(ro.default.textSync("refine",{font:"Isometric1",horizontalLayout:"full",verticalLayout:"full",whitespaceBreak:!0})).usage("<command> [options]").helpOption("-h, --help","Output usage information."),Pr(e),bt(e),kr(e),ze(e),Ve(e),$e(e),qe(e),vt(e),Sr(e),Tt(e),Xt(e),Yr(e),e.hook("preAction",async t=>{t.args.includes("dev")&&await eo()}),e.hook("postAction",t=>{let r=t.args[0];["run"].includes(r)||Gr()}),e.parse(process.argv),process.argv.slice(2).length||e.outputHelp()};Fn();
//# sourceMappingURL=cli.cjs.map